# 🔐 Supabase Connection Parameters

## Connection Details

```bash
user=postgres.gcuelkevdajcuiysyqgq
password=[YOUR-PASSWORD]  # Supabase'den alın
host=aws-1-eu-central-1.pooler.supabase.com
port=6543  # ⚠️ Session mode (NOT 5432!)
dbname=postgres
```

## ⚠️ IMPORTANT: Session Mode vs Transaction Mode

| Mode | Port | Django Compatible? |
|------|------|-------------------|
| **Session** | 6543 | ✅ YES |
| Transaction | 5432 | ❌ NO |

**Mutlaka port 6543 kullanın!**

---

## 🔧 Local Test

### 1. Install Dependencies
```bash
pip install psycopg2-binary python-dotenv
```

### 2. Test Connection
```bash
./test_supabase_connection.sh
```

Bu script şunları test eder:
- ✅ Raw psycopg2 connection
- ✅ Django database connection
- ✅ Migrations status
- ✅ Users in database

---

## 🚀 Render.com Setup

### Full Connection String

Supabase password'ünüzü `[YOUR-PASSWORD]` yerine yazın:

```
postgresql://postgres.gcuelkevdajcuiysyqgq:[YOUR-PASSWORD]@aws-1-eu-central-1.pooler.supabase.com:6543/postgres
```

### Render Environment Variable

```
Key: DATABASE_URL
Value: postgresql://postgres.gcuelkevdajcuiysyqgq:[YOUR-PASSWORD]@aws-1-eu-central-1.pooler.supabase.com:6543/postgres
```

---

## 📋 Complete Render Environment Variables

Copy-paste these to Render Dashboard → Environment:

### 1. DATABASE_URL
```
postgresql://postgres.gcuelkevdajcuiysyqgq:[YOUR-PASSWORD]@aws-1-eu-central-1.pooler.supabase.com:6543/postgres
```
**Replace `[YOUR-PASSWORD]` with your actual Supabase password!**

### 2. SECRET_KEY
```
[Auto-generated by Render or generate your own]
```

### 3. DEBUG
```
False
```

### 4. ALLOWED_HOSTS
```
.onrender.com,localhost
```

### 5. CORS_ALLOWED_ORIGINS
```
https://frontend-dua-miss.vercel.app,https://frontend-duamiss.onrender.com
```

### 6. CSRF_TRUSTED_ORIGINS
```
https://backend-duamiss.onrender.com,https://*.onrender.com,https://*.vercel.app
```

---

## 🔐 Where to Find Supabase Password?

1. Go to [Supabase Dashboard](https://supabase.com/dashboard)
2. Select your project
3. Settings → Database
4. Connection pooling → Session mode
5. Look for the connection string - password is there

**OR** if you can't see it:
1. Settings → Database → Reset Database Password
2. Copy the new password
3. Update everywhere (local .env and Render)

---

## 🧪 Test Commands

### Local Test
```bash
# Export password first
export DB_PASSWORD="your-actual-password"

# Run test
./test_supabase_connection.sh
```

### Render Shell Test
```bash
# In Render Shell:
python manage.py check --database default
python manage.py showmigrations
python manage.py migrate
```

### Create User (if needed)
```bash
python manage.py createsuperuser --username test --email test@test.com
# Enter password: tester.1
```

---

## ✅ Verification Checklist

- [ ] Password copied from Supabase
- [ ] Port is 6543 (NOT 5432)
- [ ] Connection string format is correct
- [ ] No spaces in connection string
- [ ] SSL mode is enabled (Django handles this)
- [ ] Local test passed
- [ ] Render environment updated
- [ ] Deploy successful
- [ ] Production test passed

---

## 🐛 Troubleshooting

### Error: "connection refused"
- ✅ Check port is 6543 (not 5432)
- ✅ Verify password is correct
- ✅ Check Supabase project is active

### Error: "password authentication failed"
- ✅ Reset password in Supabase
- ✅ Update .env and Render
- ✅ No extra spaces in password

### Error: "SSL required"
- ✅ Already handled in settings.py
- ✅ Make sure using pooler endpoint

---

**Ready to deploy! 🚀**

After updating Render DATABASE_URL with your actual password, redeploy and test.
